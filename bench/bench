#!/bin/sh

# In GCC, -O1 compiles faster.
[ "$(readlink "$(command -v cc)")" = 'gcc' ] && FLAGS="$FLAGS -O1"
# Set the path to compile the tests to.
if [ -z "$TMPDIR" ]; then
	if [ -d /tmp ]; then
		TMPDIR=/tmp/$tmp
	else
		TMPDIR=$PWD/$tmp
	fi
fi

tmp="$TMPDIR"__$(echo "$PWD" | sed 's/\///g; s/\.//g')

mkdir "$tmp" || exit

for file in $(echo *.c); do
	{
	base=${file%.*}-exe
	cc "$file" -o "$base" -O3 -march=native
	} &
done
wait
for file in $(echo bench-*exe); do
	./"$file" >"$file-results"
done

rm -rf "$tmp"
